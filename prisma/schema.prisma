generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid()) @db.Uuid
  name String
  email String @unique
  password String

  defaultAddressId String? @db.Uuid
  defaultAddress Address? @relation("UserDefaultAddress", fields: [defaultAddressId], references: [id], onDelete: SetNull)

  addresses Address[]
  invoices Invoice[]

  @@map("users")
}

model Address {
  id String @id @default(uuid()) @db.Uuid

  name String
  email String
  street String
  city String
  postalCode String
  country String

  userId String @db.Uuid
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  usersWithThisAsDefault User[] @relation("UserDefaultAddress")

  @@map("addresses")
}

model Invoice {
  id String @id @default(uuid()) @db.Uuid
  description String

  senderName String
  senderEmail String
  senderStreet String
  senderCity String
  senderPostalCode String
  senderCountry String

  recipientName String
  recipientEmail String
  recipientStreet String
  recipientCity String
  recipientPostalCode String
  recipientCountry String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  paymentDue DateTime
  totalPayment Decimal @db.Decimal(10, 2)
  status Status @default(Pending)

  userId String @db.Uuid
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  items Item[]

  //dodamy po id + userId
  @@index([id, userId])
  @@map("invoices")
}

model Item {
  id String @id @default(uuid()) @db.Uuid
  name String
  quantity Int
  price Decimal @db.Decimal(10, 2)

  invoiceId String @db.Uuid
  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("items")
}

enum Status {
  Draft
  Pending
  Paid
}
