generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(cuid())
  name          String
  email         String   @unique
  emailVerified Boolean  @default(false)
  image         String?

  accounts      Account[]
  sessions      Session[]
  addresses     Address[]
  invoices      Invoice[]

  defaultAddressId String? @db.Uuid
  defaultAddress   Address? @relation("UserDefaultAddress", fields: [defaultAddressId], references: [id], onDelete: SetNull)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id                    String   @id @default(cuid())
  userId                String
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  accountId             String
  providerId            String

  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?

  password              String?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@unique([providerId, accountId])
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
}

model Address {
  id         String   @id @default(uuid()) @db.Uuid

  name       String
  email      String
  street     String
  city       String
  postalCode String
  country    String

  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  usersWithThisAsDefault User[] @relation("UserDefaultAddress")
}

model Invoice {
  id                 String   @id @default(uuid()) @db.Uuid
  projectDescription String

  fromName           String
  fromEmail          String
  fromStreet         String
  fromCity           String
  fromPostCode       String
  fromCountry        String

  toName             String
  toEmail            String
  toStreet           String
  toCity             String
  toPostCode         String
  toCountry          String

  issueDate          DateTime
  paymentDue         DateTime
  paymentTerms       String
  totalPayment       Decimal  @db.Decimal(10, 2)
  status             Status   @default(Pending)

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  userId             String
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  items              Item[]

  @@index([id, userId])
}

model Item {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  quantity  Int
  price     Decimal  @db.Decimal(10, 2)

  invoiceId String   @db.Uuid
  invoice   Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

enum Status {
  Draft
  Pending
  Paid
}
